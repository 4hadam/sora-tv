name: ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù‚Ù†ÙˆØ§Øª IPTV

on:
  schedule:
    # ÙƒÙ„ ÙŠÙˆÙ… Ø¬Ù…Ø¹Ø© Ø§Ù„Ø³Ø§Ø¹Ø© 03:00 UTC (5:00 ØµØ¨Ø§Ø­Ø§Ù‹ Ø¨ØªÙˆÙ‚ÙŠØª Ù…ÙƒØ©)
    - cron: '0 3 * * 5'
  workflow_dispatch: # ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  update-channels:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: ğŸ“¥ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸŸ¢ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù…
        run: npm ci

      - name: ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù‚Ù†ÙˆØ§Øª IPTV
        run: npx tsx script/update-iptv-channels.ts
        timeout-minutes: 20

      - name: ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Pull Request
        if: ${{ env.CHANNELS_UPDATED == 'true' }}
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: 'ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù‚Ù†ÙˆØ§Øª IPTV Ù…Ù† iptv-org (ØªÙ„Ù‚Ø§Ø¦ÙŠ)'
          title: 'ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù‚Ù†ÙˆØ§Øª IPTV'
          body: |
            # ØªØ­Ø¯ÙŠØ« Ù‚Ù†ÙˆØ§Øª IPTV ğŸ“º
            
            ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù‚Ù†ÙˆØ§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù†:
            https://github.com/iptv-org/iptv
            
            **Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª:**
            - âœ… ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
            - âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø´ØºØ§Ù„Ø© ÙÙ‚Ø·
            - âœ… ØªÙ… ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆÙ„
            
            ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ù…Ø¬.
          branch: update-iptv-channels
          authors: |
            github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>
          delete-branch: true

      - name: ğŸ“Š Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: update-report
          path: ./script/update-report.json
          retention-days: 30
